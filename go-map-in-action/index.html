<!DOCTYPE html>
<html lang="ko-KR">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="Go map in action"/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@vjeantet"/>



  	<meta property="og:title" content="Go map in action &middot; " />
  	<meta property="og:site_name" content="" />
  	<meta property="og:url" content="http://shyr.github.io/go-map-in-action/" />

    
        
            <meta property="og:image" content="/images/cover_polenord.jpg"/>
        
    

    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2014-07-11T10:54:24&#43;02:00" />

    
    

    <title>Go map in action &middot; </title>

    
    <meta name="description" content="Go maps in action 6 February 2013
Introduction One of the most useful data structures in computer science is the hash table. Many hash table implementations exi" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/images/favicon.ico">
	  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/css/nav.css" />

    

    

    
      
          <link href="/index.xml" rel="alternate" type="application/rss+xml" title="" />
      
      
    
    <meta name="generator" content="Hugo 0.36" />

    <link rel="canonical" href="http://shyr.github.io/go-map-in-action/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": ,
        "logo": http://shyr.github.io/images/logo.png
    },
    "author": {
        "@type": "Person",
        "name": ,
        
        "image": {
            "@type": "ImageObject",
            "url": http://shyr.github.io/images/logo.png,
            "width": 250,
            "height": 250
        }, 
        
        "url": ,
        "sameAs": [
            
            
             
             
             
             
             
            
        ],
        "description": IT software and Security Engineer, Open source enthusiast.
        
    },
    "headline": Go map in action,
    "name": Go map in action,
    "wordCount": 1367,
    "timeRequired": "PT7M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": en
    },
    "url": http://shyr.github.io/go-map-in-action/,
    "datePublished": 2014-07-11T10:54Z,
    "dateModified": 2014-07-11T10:54Z,
    
    
    "description": ,
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": http://shyr.github.io/go-map-in-action/
    }
}
    </script>
    


    

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-91453496-1', 'auto');
      ga('send', 'pageview');

    </script>
    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://facebook.com/shyr">Facebook</a>
            </li>
        
            <h3>Follow me</h3>
            <li class="nav-opened" role="presentation">
            	<a href="https://github.com/shyr">Github repos</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/">Blog</a>
            </li>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
      <a class="blog-logo" href="http://shyr.github.io/"><img src="/images/logo.png" alt="Home" /></a>
  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Go map in action</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2014-07-11T10:54:24&#43;02:00">
            Jul 11, 2014
          </time>
        
         
        </section>
    </header>

    <section class="post-content">
      <p>Go maps in action
6 February 2013</p>

<p>Introduction
One of the most useful data structures in computer science is the hash table. Many hash table implementations exist with varying properties, but in general they offer fast lookups, adds, and deletes. Go provides a built-in map type that implements a hash table.</p>

<p>Declaration and initialization
A Go map type looks like this:</p>

<p>map[KeyType]ValueType
where KeyType may be any type that is comparable (more on this later), and ValueType may be any type at all, including another map!</p>

<p>This variable m is a map of string keys to int values:</p>

<p>var m map[string]int
Map types are reference types, like pointers or slices, and so the value of m above is nil; it doesn&rsquo;t point to an initialized map. A nil map behaves like an empty map when reading, but attempts to write to a nil map will cause a runtime panic; don&rsquo;t do that. To initialize a map, use the built in make function:</p>

<p>m = make(map[string]int)
The make function allocates and initializes a hash map data structure and returns a map value that points to it. The specifics of that data structure are an implementation detail of the runtime and are not specified by the language itself. In this article we will focus on the use of maps, not their implementation.</p>

<p>Working with maps
Go provides a familiar syntax for working with maps. This statement sets the key &ldquo;route&rdquo; to the value 66:</p>

<p>m[&ldquo;route&rdquo;] = 66
This statement retrieves the value stored under the key &ldquo;route&rdquo; and assigns it to a new variable i:</p>

<p>i := m[&ldquo;route&rdquo;]
If the requested key doesn&rsquo;t exist, we get the value type&rsquo;s zero value. In this case the value type is int, so the zero value is 0:</p>

<p>j := m[&ldquo;root&rdquo;]
// j == 0
The built in len function returns on the number of items in a map:</p>

<p>n := len(m)
The built in delete function removes an entry from the map:</p>

<p>delete(m, &ldquo;route&rdquo;)
The delete function doesn&rsquo;t return anything, and will do nothing if the specified key doesn&rsquo;t exist.</p>

<p>A two-value assignment tests for the existence of a key:</p>

<p>i, ok := m[&ldquo;route&rdquo;]
In this statement, the first value (i) is assigned the value stored under the key &ldquo;route&rdquo;. If that key doesn&rsquo;t exist, i is the value type&rsquo;s zero value (0). The second value (ok) is a bool that is true if the key exists in the map, and false if not.</p>

<p>To test for a key without retrieving the value, use an underscore in place of the first value:</p>

<p>_, ok := m[&ldquo;route&rdquo;]
To iterate over the contents of a map, use the range keyword:</p>

<p>for key, value := range m {
    fmt.Println(&ldquo;Key:&ldquo;, key, &ldquo;Value:&ldquo;, value)
}
To initialize a map with some data, use a map literal:</p>

<p>commits := map[string]int{
    &ldquo;rsc&rdquo;: 3711,
    &ldquo;r&rdquo;:   2138,
    &ldquo;gri&rdquo;: 1908,
    &ldquo;adg&rdquo;: 912,
}
The same syntax may be used to initialize an empty map, which is functionally identical to using the make function:</p>

<p>m = map[string]int{}
Exploiting zero values
It can be convenient that a map retrieval yields a zero value when the key is not present.</p>

<p>For instance, a map of boolean values can be used as a set-like data structure (recall that the zero value for the boolean type is false). This example traverses a linked list of Nodes and prints their values. It uses a map of Node pointers to detect cycles in the list.</p>

<pre><code>type Node struct {
    Next  *Node
    Value interface{}
}
var first *Node

visited := make(map[*Node]bool)
for n := first; n != nil; n = n.Next {
    if visited[n] {
        fmt.Println(&quot;cycle detected&quot;)
        break
    }
    visited[n] = true
    fmt.Println(n.Value)
}
</code></pre>

<p>The expression visited[n] is true if n has been visited, or false if n is not present. There&rsquo;s no need to use the two-value form to test for the presence of n in the map; the zero value default does it for us.</p>

<p>Another instance of helpful zero values is a map of slices. Appending to a nil slice just allocates a new slice, so it&rsquo;s a one-liner to append a value to a map of slices; there&rsquo;s no need to check if the key exists. In the following example, the slice people is populated with Person values. Each Person has a Name and a slice of Likes. The example creates a map to associate each like with a slice of people that like it.</p>

<pre><code>type Person struct {
    Name  string
    Likes []string
}
var people []*Person

likes := make(map[string][]*Person)
for _, p := range people {
    for _, l := range p.Likes {
        likes[l] = append(likes[l], p)
    }
}
</code></pre>

<p>To print a list of people who like cheese:</p>

<pre><code>for _, p := range likes[&quot;cheese&quot;] {
    fmt.Println(p.Name, &quot;likes cheese.&quot;)
}
</code></pre>

<p>To print the number of people who like bacon:</p>

<pre><code>fmt.Println(len(likes[&quot;bacon&quot;]), &quot;people like bacon.&quot;)
</code></pre>

<p>Note that since both range and len treat a nil slice as a zero-length slice, these last two examples will work even if nobody likes cheese or bacon (however unlikely that may be).</p>

<p>Key types
As mentioned earlier, map keys may be of any type that is comparable. The language spec defines this precisely, but in short, comparable types are boolean, numeric, string, pointer, channel, and interface types, and structs or arrays that contain only those types. Notably absent from the list are slices, maps, and functions; these types cannot be compared using ==, and may not be used as map keys.</p>

<p>It&rsquo;s obvious that strings, ints, and other basic types should be available as map keys, but perhaps unexpected are struct keys. Struct can be used to key data by multiple dimensions. For example, this map of maps could be used to tally web page hits by country:</p>

<p>hits := make(map[string]map[string]int)
This is map of string to (map of string to int). Each key of the outer map is the path to a web page with its own inner map. Each inner map key is a two-letter country code. This expression retrieves the number of times an Australian has loaded the documentation page:</p>

<p>n := hits[&ldquo;/doc/&rdquo;][&ldquo;au&rdquo;]
Unfortunately, this approach becomes unwieldy when adding data, as for any given outer key you must check if the inner map exists, and create it if needed:</p>

<p>func add(m map[string]map[string]int, path, country string) {
    mm, ok := m[path]
    if !ok {
        mm = make(map[string]int)
        m[path] = mm
    }
    mm[country]++
}
add(hits, &ldquo;/doc/&rdquo;, &ldquo;au&rdquo;)
On the other hand, a design that uses a single map with a struct key does away with all that complexity:</p>

<p>type Key struct {
    Path, Country string
}
hits := make(map[Key]int)
When an Vietnamese person visits the home page, incrementing (and possibly creating) the appropriate counter is a one-liner:</p>

<p>hits[Key{&ldquo;/&rdquo;, &ldquo;vn&rdquo;}]++
And it&rsquo;s similarly straightforward to see how many Swiss people have read the spec:</p>

<p>n := hits[Key{&ldquo;/ref/spec&rdquo;, &ldquo;ch&rdquo;}]
Concurrency
Maps are not safe for concurrent use: it&rsquo;s not defined what happens when you read and write to them simultaneously. If you need to read from and write to a map from concurrently executing goroutines, the accesses must be mediated by some kind of synchronization mechanism. One common way to protect maps is with sync.RWMutex.</p>

<p>This statement declares a counter variable that is an anonymous struct containing a map and an embedded sync.RWMutex.</p>

<p>var counter = struct{
    sync.RWMutex
    m map[string]int
}{m: make(map[string]int)}
To read from the counter, take the read lock:</p>

<p>counter.RLock()
n := counter.m[&ldquo;some_key&rdquo;]
counter.RUnlock()
fmt.Println(&ldquo;some_key:&ldquo;, n)
To write to the counter, take the write lock:</p>

<p>counter.Lock()
counter.m[&ldquo;some_key&rdquo;]++
counter.Unlock()
Iteration order
When iterating over a map with a range loop, the iteration order is not specified and is not guaranteed to be the same from one iteration to the next. Since Go 1 the runtime randomizes map iteration order, as programmers relied on the stable iteration order of the previous implementation. If you require a stable iteration order you must maintain a separate data structure that specifies that order. This example uses a separate sorted slice of keys to print a map[int]string in key order:</p>

<p>import &ldquo;sort&rdquo;</p>

<p>var m map[int]string
var keys []int
for k := range m {
    keys = append(keys, k)
}
sort.Ints(keys)
for _, k := range keys {
    fmt.Println(&ldquo;Key:&ldquo;, k, &ldquo;Value:&ldquo;, m[k])
}
By Andrew Gerrand</p>

    </section>


  <footer class="post-footer">


    








<figure class="author-image">
    <a class="img" href="http://shyr.github.io/" style="background-image: url(/images/logo.png)"><span class="hidden">stephen's Picture</span></a>
</figure>


<section class="author">
  <h4><a href="http://shyr.github.io/">stephen</a></h4>
  
  <p>IT software and Security Engineer, Open source enthusiast.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Korea</span>
    
  </div>
</section>




    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Go%20map%20in%20action&nbsp;-&nbsp;&amp;url=http%3a%2f%2fshyr.github.io%2fgo-map-in-action%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fshyr.github.io%2fgo-map-in-action%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=http%3a%2f%2fshyr.github.io%2fgo-map-in-action%2f&amp;description=Go%20map%20in%20action"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=http%3a%2f%2fshyr.github.io%2fgo-map-in-action%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    

<div id="disqus_thread"></div>
<script>




var disqus_config = function () {
this.page.url = "http:\/\/shyr.github.io\/go-map-in-action\/";  
this.page.identifier = "http:\/\/shyr.github.io\/go-map-in-action\/"; 
};

(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://shyr.github.io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>








  </footer>
</article>

</main>


  <aside class="read-next">
  
      <a class="read-next-story" style="no-cover" href="/">
          <section class="post">
              <h2></h2>
              
          </section>
      </a>
  
  
</aside>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href=""></a> All rights reserved</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
    
</body>
</html>

